// // import { Officer } from "../types";
const filteredByStateData = [
  {
    id: 1,
    agencyName: "Milton Police Department",
    peaceOfficerList: [
      {
        id: 1,
        UID: "2",
        name: "Timothy  Hanley",
        workHistory: [
          {
            id: 1,
            startDate: "1998-02-22",
            separationDate: "2000-01-29",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 17,
        UID: "162",
        name: "Stuart  Ashley",
        workHistory: [
          {
            id: 64,
            startDate: "1989-04-12",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 65,
            startDate: "1989-06-14",
            separationDate: "1990-12-12",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 26,
        UID: "347",
        name: "Randall  Barrows",
        workHistory: [
          {
            id: 97,
            startDate: "1980-03-01",
            separationDate: "1994-12-31",
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 2,
    agencyName: "Vermont State Police",
    peaceOfficerList: [
      {
        id: 1,
        UID: "2",
        name: "Timothy  Hanley",
        workHistory: [
          {
            id: 2,
            startDate: "2000-02-01",
            separationDate: "2015-05-16",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 2,
        UID: "5",
        name: "Michael  Aamodt",
        workHistory: [
          {
            id: 6,
            startDate: "1996-10-21",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 7,
            startDate: "2011-11-18",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 8,
            startDate: "2013-05-19",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 9,
            startDate: null,
            separationDate: "2020-08-29",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 5,
        UID: "47",
        name: "Henry  Alberico",
        workHistory: [
          {
            id: 25,
            startDate: "2009-01-12",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 26,
            startDate: "2013-02-24",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 27,
            startDate: "2014-08-24",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 6,
        UID: "49",
        name: "Eric  Albright",
        workHistory: [
          {
            id: 28,
            startDate: "1994-08-01",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 29,
            startDate: "2011-11-18",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 30,
            startDate: "2018-12-23",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 10,
        UID: "89",
        name: "Matthew  Amadon",
        workHistory: [
          {
            id: 42,
            startDate: "2000-07-31",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 43,
            startDate: "2011-11-18",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 44,
            startDate: "2014-09-21",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 45,
            startDate: "2015-03-22",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 46,
            startDate: null,
            separationDate: "2021-08-28",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 12,
        UID: "92",
        name: "Todd  Ambroz",
        workHistory: [
          {
            id: 50,
            startDate: "2000-01-31",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 51,
            startDate: "2014-04-06",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 52,
            startDate: null,
            separationDate: "2021-09-01",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 16,
        UID: "126",
        name: "Darren  Annis",
        workHistory: [
          {
            id: 60,
            startDate: "1994-08-01",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 61,
            startDate: "2011-11-18",
            separationDate: "2020-11-21",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 19,
        UID: "211",
        name: "Lionel  Bachand",
        workHistory: [
          {
            id: 72,
            startDate: "1980-01-07",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 73,
            startDate: "2006-08-20",
            separationDate: "2009-10-23",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 20,
        UID: "281",
        name: "Gerald  Ballinger",
        workHistory: [
          {
            id: 75,
            startDate: "2001-02-27",
            separationDate: "2019-04-26",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 21,
        UID: "282",
        name: "Owen  Ballinger",
        workHistory: [
          {
            id: 77,
            startDate: "1999-02-01",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 78,
            startDate: "2016-06-12",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 79,
            startDate: "2022-05-26",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 22,
        UID: "298",
        name: "Christopher  Barber",
        workHistory: [
          {
            id: 80,
            startDate: "2000-01-31",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 81,
            startDate: "2011-11-18",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 82,
            startDate: "2019-04-28",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 3,
    agencyName: "Franklin County Sheriff's Department",
    peaceOfficerList: [
      {
        id: 2,
        UID: "5",
        name: "Michael  Aamodt",
        workHistory: [
          {
            id: 3,
            startDate: "1993-04-27",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 4,
            startDate: "1994-07-01",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 5,
            startDate: null,
            separationDate: "1996-10-21",
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 4,
    agencyName: "Burlington Police Department",
    peaceOfficerList: [
      {
        id: 3,
        UID: "35",
        name: "Michael  Ahearn",
        workHistory: [
          {
            id: 10,
            startDate: "2001-07-30",
            separationDate: "2010-02-12",
            separationReason: "N/A",
          },
          {
            id: 11,
            startDate: "2008-08-06",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 5,
    agencyName: "Grand Isle County Sheriff's Department",
    peaceOfficerList: [
      {
        id: 3,
        UID: "35",
        name: "Michael  Ahearn",
        workHistory: [
          {
            id: 12,
            startDate: "2009-07-01",
            separationDate: "2020-07-31",
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 9,
        UID: "83",
        name: "Ray  Allen",
        workHistory: [
          {
            id: 40,
            startDate: "1991-03-25",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 41,
            startDate: "2011-07-08",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 6,
    agencyName: "St. Albans Police Dept",
    peaceOfficerList: [
      {
        id: 3,
        UID: "35",
        name: "Michael  Ahearn",
        workHistory: [
          {
            id: 13,
            startDate: "2000-04-17",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 14,
            startDate: "2000-07-19",
            separationDate: "2001-07-30",
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
  {
    id: 7,
    agencyName: "Colchester Police Department",
    peaceOfficerList: [
      {
        id: 4,
        UID: "45",
        name: "Michael  Akerlind",
        workHistory: [
          {
            id: 15,
            startDate: "1998-12-21",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 16,
            startDate: "2013-07-31",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 8,
        UID: "75",
        name: "Douglas  Allen",
        workHistory: [
          {
            id: 35,
            startDate: "1984-01-02",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 36,
            startDate: "2013-07-31",
            separationDate: null,
            separationReason: "N/A",
          },
          {
            id: 37,
            startDate: "2018-08-10",
            separationDate: null,
            separationReason: "N/A",
          },
        ],
      },
      {
        id: 17,
        UID: "162",
        name: "Stuart  Ashley",
        workHistory: [
          {
            id: 63,
            startDate: "1990-12-12",
            separationDate: "2005-03-04",
            separationReason: "N/A",
          },
        ],
      },
    ],
  },
];

export interface WorkHistory {
  id: number;
  startDate: string | null;
  separationDate: string | null;
  separationReason: string;
  agencyName?: string;
}

export interface PeaceOfficer {
  id: number;
  UID: string;
  name: string;
  workHistory: WorkHistory[];
}

interface Agency {
  id: number;
  agencyName: string;
  peaceOfficerList: PeaceOfficer[];
}

// Flatten all officers from all agencies into a single list and add agency name to each work history
const flattenOfficers = (data: Agency[]): PeaceOfficer[] => {
  // Create a map to ensure unique officers based on UID
  const officerMap = new Map<string, PeaceOfficer>();

  data.forEach((agency) => {
    agency.peaceOfficerList.forEach((officer) => {
      if (!officerMap.has(officer.UID)) {
        // Create a new officer entry with agency name added to each work history
        officerMap.set(officer.UID, {
          ...officer,
          workHistory: officer.workHistory.map((history) => ({
            ...history,
            agencyName: agency.agencyName,
          })),
        });
      } else {
        // Update existing officer entry with additional work history
        const existingOfficer = officerMap.get(officer.UID)!;
        existingOfficer.workHistory.push(
          ...officer.workHistory.map((history) => ({
            ...history,
            agencyName: agency.agencyName,
          }))
        );
      }
    });
  });

  return Array.from(officerMap.values());
};

// Main function to get officers by agency
export const getOfficersByAgency = (
  agencyName: string,
  page: number,
  perPage: number
): { officers: PeaceOfficer[]; totalItems: number } => {
  // Flatten all officers from all agencies
  const allOfficers = flattenOfficers(filteredByStateData);

  // Filter by agency name if specified
  const filteredOfficers =
    agencyName === "all"
      ? allOfficers
      : allOfficers.filter((officer) =>
          officer.workHistory.some(
            (history) => history.agencyName === agencyName
          )
        );

  // Calculate total items after filtering
  const totalItems = filteredOfficers.length;

  // Calculate the range of items for pagination
  const startIndex = (page - 1) * perPage;
  const endIndex = Math.min(startIndex + perPage, totalItems);
  const paginatedOfficers = filteredOfficers.slice(startIndex, endIndex);

  return {
    officers: paginatedOfficers,
    totalItems,
  };
};
